{"version":3,"sources":["../src/context/config/config.provider.tsx","../src/utils/invariant.ts","../src/context/config/config.context.ts","../src/utils/call-monitor.ts","../src/hooks/use-call-authorized.tsx","../src/cwv-monitor.tsx"],"names":["invariant","condition","message","ConfigContext","createContext","useConfig","context","use","Fetcher","apiUrl","apiKey","abortTime","_0","__async","endpoint","queryParams","schema","config","params","qs","__spreadValues","fullUrl","abortController","abortTimeout","response","__spreadProps","e","data","success","parsedData","ConfigProvider","children","fetcher","useState","jsx","useCallAuthorized","useEffect","z","HookCaller","CWVMonitor","_a","props","__objRest"],"mappings":"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","file":"index.js","sourcesContent":["import { useState } from 'react';\nimport { ConfigContext } from './config.context.js';\nimport { Fetcher } from '../../utils/call-monitor.js';\n\ninterface Props {\n  children: React.ReactNode;\n  endpoint: string;\n  apiKey: string;\n  abortTime?: number;\n}\n\nexport const ConfigProvider: React.FC<Props> = ({ children, apiKey, endpoint, abortTime }) => {\n  const [fetcher] = useState(new Fetcher(endpoint, apiKey, abortTime));\n  return <ConfigContext.Provider value={{ fetcher }}>{children}</ConfigContext.Provider>;\n};\n","export function invariant(condition: unknown, message: string): asserts condition {\n  if (!condition) {\n    throw new Error(message);\n  }\n}\n","import { createContext, use } from 'react';\nimport { invariant } from '../../utils/invariant.js';\nimport type { Fetcher } from '../../utils/call-monitor.js';\n\nexport interface ConfigContext {\n  fetcher: Fetcher;\n}\n\nexport const ConfigContext = createContext<ConfigContext | undefined>(undefined);\n\nexport const useConfig = () => {\n  const context = use(ConfigContext);\n  invariant(context, 'To use config, you have to use ConfigContext.Provider');\n  return context;\n};\n","import type z from 'zod';\nimport qs from 'qs';\n\ninterface Fetch<T extends z.ZodTypeAny> {\n  schema: T;\n  endpoint: `/${string}`;\n  config?: Parameters<typeof fetch>[1];\n  queryParams?: Record<string, string>;\n}\n\nexport class Fetcher {\n  constructor(\n    private readonly apiUrl: string,\n    private readonly apiKey: string,\n    private readonly abortTime?: number\n  ) {}\n\n  fetch = async <T extends z.ZodTypeAny>({ endpoint, queryParams, schema, config }: Fetch<T>) => {\n    const params = qs.stringify({ ...queryParams }, { addQueryPrefix: true });\n    const fullUrl = `${this.apiUrl}${endpoint}${params}`;\n    let abortController: AbortController | undefined;\n    let abortTimeout: number | undefined;\n    if (this.abortTime) {\n      abortController = new AbortController();\n      abortTimeout = setTimeout(() => {\n        abortController?.abort();\n      }, this.abortTime);\n    }\n    let response;\n    try {\n      response = await fetch(fullUrl, {\n        ...(abortController && { signal: abortController.signal }),\n        ...config,\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${this.apiKey}`,\n          ...config?.headers\n        }\n      });\n    } catch {\n      // Never throw error to client\n      return null;\n    }\n\n    if (typeof abortTimeout !== 'undefined') {\n      clearTimeout(abortTimeout);\n    }\n    // Never throw error to client\n    if (!response.ok) {\n      return null;\n    }\n\n    const data: unknown = await response.json();\n    const { success, data: parsedData } = schema.safeParse(data);\n    if (!success) {\n      return null;\n    }\n    return parsedData as z.output<T>;\n  };\n}\n","import { useEffect } from 'react';\nimport { useConfig } from '../context/config/config.context.js';\nimport z from 'zod';\n\nexport const useCallAuthorized = () => {\n  const { fetcher } = useConfig();\n  useEffect(() => {\n    fetcher\n      .fetch({\n        endpoint: '/api/protected',\n        schema: z.object({ ok: z.literal(true) })\n      })\n      .then(console.log)\n      .catch(() => {\n        console.log('Failed');\n      });\n  }, []);\n};\n","import { ConfigProvider } from './context/config/config.provider.js';\nimport { useCallAuthorized } from './hooks/use-call-authorized.js';\n\ntype Props = Omit<React.ComponentProps<typeof ConfigProvider>, 'children'>;\n\nconst HookCaller: React.FC = () => {\n  useCallAuthorized();\n  return null;\n};\n\nexport const CWVMonitor: React.FC<Props> = ({ ...props }) => {\n  return (\n    <ConfigProvider {...props}>\n      <HookCaller />\n    </ConfigProvider>\n  );\n};\n"]}