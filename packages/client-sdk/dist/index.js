import {createContext,useState,useEffect,use}from'react';import q from'qs';import {jsx}from'react/jsx-runtime';import b from'zod';var $=Object.defineProperty,E=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable;var h=(e,t,o)=>t in e?$(e,t,{enumerable:true,configurable:true,writable:true,value:o}):e[t]=o,s=(e,t)=>{for(var o in t||(t={}))C.call(t,o)&&h(e,o,t[o]);if(p)for(var o of p(t))g.call(t,o)&&h(e,o,t[o]);return e},f=(e,t)=>E(e,K(t));var y=(e,t)=>{var o={};for(var r in e)C.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&p)for(var r of p(e))t.indexOf(r)<0&&g.call(e,r)&&(o[r]=e[r]);return o};var x=(e,t,o)=>new Promise((r,i)=>{var F=n=>{try{c(o.next(n));}catch(a){i(a);}},l=n=>{try{c(o.throw(n));}catch(a){i(a);}},c=n=>n.done?r(n.value):Promise.resolve(n.value).then(F,l);c((o=o.apply(e,t)).next());});function T(e,t){if(!e)throw new Error(t)}var m=createContext(void 0),P=()=>{let e=use(m);return T(e,"To use config, you have to use ConfigContext.Provider"),e};var u=class{constructor(t,o,r){this.apiUrl=t;this.apiKey=o;this.abortTime=r;this.fetch=F=>x(this,[F],function*({endpoint:t,queryParams:o,schema:r,config:i}){let l=q.stringify(s({},o),{addQueryPrefix:true}),c=`${this.apiUrl}${t}${l}`,n,a;this.abortTime&&(n=new AbortController,a=setTimeout(()=>{n==null||n.abort();},this.abortTime));let d;try{d=yield fetch(c,f(s(s({},n&&{signal:n.signal}),i),{headers:s({"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},i==null?void 0:i.headers)}));}catch(H){return null}if(typeof a!="undefined"&&clearTimeout(a),!d.ok)return null;let A=yield d.json(),{success:R,data:k}=r.safeParse(A);return R?k:null});}};var v=({children:e,apiKey:t,endpoint:o,abortTime:r})=>{let[i]=useState(new u(o,t,r));return jsx(m.Provider,{value:{fetcher:i},children:e})};var z=()=>{let{fetcher:e}=P();useEffect(()=>{e.fetch({endpoint:"/api/protected",schema:b.object({ok:b.literal(true)})}).then(console.log).catch(()=>{console.log("Failed");});},[]);};var D=()=>(z(),null),ae=t=>{var e=y(t,[]);return console.log("TEST"),jsx(v,f(s({},e),{children:jsx(D,{})}))};export{ae as CWVMonitor};//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map